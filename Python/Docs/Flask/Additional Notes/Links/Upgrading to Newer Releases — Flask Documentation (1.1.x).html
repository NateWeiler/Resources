
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Upgrading to Newer Releases &#8212; Flask Documentation (1.1.x)</title>
    <link rel="stylesheet" href="../_static/flask.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="https://assets.readthedocs.org/static/css/badge_only.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="shortcut icon" href="../_static/flask-icon.png"/>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" />
    <link rel="next" title="Changelog" href="../changelog/" />
    <link rel="prev" title="Pocoo Styleguide" href="../styleguide/" />
    <link rel="canonical" href="https://flask.palletsprojects.com/en/1.1.x/upgrading/">
  <script>DOCUMENTATION_OPTIONS.URL_ROOT = '../';</script>
   
  
<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="https://flask.palletsprojects.com/en/1.1.x/upgrading/" />

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = "upgrading"
READTHEDOCS_DATA['source_suffix'] = ".rst"
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex/" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex/" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../changelog/" title="Changelog"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../styleguide/" title="Pocoo Styleguide"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../">Flask Documentation (1.1.x)</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="upgrading-to-newer-releases">
<h1>Upgrading to Newer Releases<a class="headerlink" href="#upgrading-to-newer-releases" title="Permalink to this headline">¶</a></h1>
<p>Flask itself is changing like any software is changing over time.  Most of
the changes are the nice kind, the kind where you don’t have to change
anything in your code to profit from a new release.</p>
<p>However every once in a while there are changes that do require some
changes in your code or there are changes that make it possible for you to
improve your own code quality by taking advantage of new features in
Flask.</p>
<p>This section of the documentation enumerates all the changes in Flask from
release to release and how you can change your code to have a painless
updating experience.</p>
<p>Use the <strong class="command">pip</strong> command to upgrade your existing Flask installation by
providing the <code class="docutils literal notranslate"><span class="pre">--upgrade</span></code> parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install --upgrade Flask
</pre></div>
</div>
<div class="section" id="version-0-12">
<span id="upgrading-to-012"></span><h2>Version 0.12<a class="headerlink" href="#version-0-12" title="Permalink to this headline">¶</a></h2>
<div class="section" id="changes-to-send-file">
<h3>Changes to send_file<a class="headerlink" href="#changes-to-send-file" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">filename</span></code> is no longer automatically inferred from file-like objects.
This means that the following code will no longer automatically have
<code class="docutils literal notranslate"><span class="pre">X-Sendfile</span></code> support, etag generation or MIME-type guessing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">send_file</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/path/to/file.txt&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Any of the following is functionally equivalent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;/path/to/file.txt&#39;</span>

<span class="c1"># Just pass the filepath directly</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">send_file</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

<span class="c1"># Set the MIME-type and ETag explicitly</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">send_file</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span> <span class="n">mimetype</span><span class="o">=</span><span class="s1">&#39;text/plain&#39;</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">set_etag</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># Set `attachment_filename` for MIME-type guessing</span>
<span class="c1"># ETag still needs to be manually set</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">send_file</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span> <span class="n">attachment_filename</span><span class="o">=</span><span class="n">fname</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">set_etag</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>The reason for this is that some file-like objects have an invalid or even
misleading <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute. Silently swallowing errors in such cases was not
a satisfying solution.</p>
<p>Additionally the default of falling back to <code class="docutils literal notranslate"><span class="pre">application/octet-stream</span></code> has
been restricted. If Flask can’t guess one or the user didn’t provide one, the
function fails if no filename information was provided.</p>
</div>
</div>
<div class="section" id="version-0-11">
<span id="upgrading-to-011"></span><h2>Version 0.11<a class="headerlink" href="#version-0-11" title="Permalink to this headline">¶</a></h2>
<p>0.11 is an odd release in the Flask release cycle because it was supposed
to be the 1.0 release.  However because there was such a long lead time up
to the release we decided to push out a 0.11 release first with some
changes removed to make the transition easier.  If you have been tracking
the master branch which was 1.0 you might see some unexpected changes.</p>
<p>In case you did track the master branch you will notice that
<strong class="command">flask --app</strong> is removed now.
You need to use the environment variable to specify an application.</p>
<div class="section" id="debugging">
<h3>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h3>
<p>Flask 0.11 removed the <code class="docutils literal notranslate"><span class="pre">debug_log_format</span></code> attribute from Flask
applications.  Instead the new <code class="docutils literal notranslate"><span class="pre">LOGGER_HANDLER_POLICY</span></code> configuration can
be used to disable the default log handlers and custom log handlers can be
set up.</p>
</div>
<div class="section" id="error-handling">
<h3>Error handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h3>
<p>The behavior of error handlers was changed.
The precedence of handlers used to be based on the decoration/call order of
<a class="reference internal" href="../api/#flask.Flask.errorhandler" title="flask.Flask.errorhandler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">errorhandler()</span></code></a> and
<a class="reference internal" href="../api/#flask.Flask.register_error_handler" title="flask.Flask.register_error_handler"><code class="xref py py-meth docutils literal notranslate"><span class="pre">register_error_handler()</span></code></a>, respectively.
Now the inheritance hierarchy takes precedence and handlers for more
specific exception classes are executed instead of more general ones.
See <a class="reference internal" href="../errorhandling/#error-handlers"><span class="std std-ref">Error handlers</span></a> for specifics.</p>
<p>Trying to register a handler on an instance now raises <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There used to be a logic error allowing you to register handlers
only for exception <em>instances</em>. This was unintended and plain wrong,
and therefore was replaced with the intended behavior of registering
handlers only using exception classes and HTTP error codes.</p>
</div>
</div>
<div class="section" id="templating">
<h3>Templating<a class="headerlink" href="#templating" title="Permalink to this headline">¶</a></h3>
<p>The <code class="xref py py-func docutils literal notranslate"><span class="pre">render_template_string()</span></code> function has changed to
autoescape template variables by default. This better matches the behavior
of <code class="xref py py-func docutils literal notranslate"><span class="pre">render_template()</span></code>.</p>
</div>
<div class="section" id="extension-imports">
<h3>Extension imports<a class="headerlink" href="#extension-imports" title="Permalink to this headline">¶</a></h3>
<p>Extension imports of the form <code class="docutils literal notranslate"><span class="pre">flask.ext.foo</span></code> are deprecated, you should use
<code class="docutils literal notranslate"><span class="pre">flask_foo</span></code>.</p>
<p>The old form still works, but Flask will issue a
<code class="docutils literal notranslate"><span class="pre">flask.exthook.ExtDeprecationWarning</span></code> for each extension you import the old
way. We also provide a migration utility called <a class="reference external" href="https://github.com/pallets/flask-ext-migrate">flask-ext-migrate</a> that is supposed to
automatically rewrite your imports for this.</p>
</div>
</div>
<div class="section" id="version-0-10">
<span id="upgrading-to-010"></span><h2>Version 0.10<a class="headerlink" href="#version-0-10" title="Permalink to this headline">¶</a></h2>
<p>The biggest change going from 0.9 to 0.10 is that the cookie serialization
format changed from pickle to a specialized JSON format.  This change has
been done in order to avoid the damage an attacker can do if the secret
key is leaked.  When you upgrade you will notice two major changes: all
sessions that were issued before the upgrade are invalidated and you can
only store a limited amount of types in the session.  The new sessions are
by design much more restricted to only allow JSON with a few small
extensions for tuples and strings with HTML markup.</p>
<p>In order to not break people’s sessions it is possible to continue using
the old session system by using the <a class="reference external" href="https://pythonhosted.org/Flask-OldSessions/">Flask-OldSessions</a> extension.</p>
<p>Flask also started storing the <a class="reference internal" href="../api/#flask.g" title="flask.g"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.g</span></code></a> object on the application
context instead of the request context.  This change should be transparent
for you but it means that you now can store things on the <code class="docutils literal notranslate"><span class="pre">g</span></code> object
when there is no request context yet but an application context.  The old
<code class="docutils literal notranslate"><span class="pre">flask.Flask.request_globals_class</span></code> attribute was renamed to
<a class="reference internal" href="../api/#flask.Flask.app_ctx_globals_class" title="flask.Flask.app_ctx_globals_class"><code class="xref py py-attr docutils literal notranslate"><span class="pre">flask.Flask.app_ctx_globals_class</span></code></a>.</p>
</div>
<div class="section" id="version-0-9">
<h2>Version 0.9<a class="headerlink" href="#version-0-9" title="Permalink to this headline">¶</a></h2>
<p>The behavior of returning tuples from a function was simplified.  If you
return a tuple it no longer defines the arguments for the response object
you’re creating, it’s now always a tuple in the form <code class="docutils literal notranslate"><span class="pre">(response,</span> <span class="pre">status,</span>
<span class="pre">headers)</span></code> where at least one item has to be provided.  If you depend on
the old behavior, you can add it easily by subclassing Flask:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TraditionalFlask</span><span class="p">(</span><span class="n">Flask</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">make_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rv</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_class</span><span class="p">(</span><span class="o">*</span><span class="n">rv</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Flask</span><span class="o">.</span><span class="n">make_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rv</span><span class="p">)</span>
</pre></div>
</div>
<p>If you maintain an extension that was using <a class="reference internal" href="../api/#flask._request_ctx_stack" title="flask._request_ctx_stack"><code class="xref py py-data docutils literal notranslate"><span class="pre">_request_ctx_stack</span></code></a>
before, please consider changing to <a class="reference internal" href="../api/#flask._app_ctx_stack" title="flask._app_ctx_stack"><code class="xref py py-data docutils literal notranslate"><span class="pre">_app_ctx_stack</span></code></a> if it makes
sense for your extension.  For instance, the app context stack makes sense for
extensions which connect to databases.  Using the app context stack instead of
the request context stack will make extensions more readily handle use cases
outside of requests.</p>
</div>
<div class="section" id="version-0-8">
<h2>Version 0.8<a class="headerlink" href="#version-0-8" title="Permalink to this headline">¶</a></h2>
<p>Flask introduced a new session interface system.  We also noticed that
there was a naming collision between <code class="docutils literal notranslate"><span class="pre">flask.session</span></code> the module that
implements sessions and <a class="reference internal" href="../api/#flask.session" title="flask.session"><code class="xref py py-data docutils literal notranslate"><span class="pre">flask.session</span></code></a> which is the global session
object.  With that introduction we moved the implementation details for
the session system into a new module called <code class="xref py py-mod docutils literal notranslate"><span class="pre">flask.sessions</span></code>.  If you
used the previously undocumented session support we urge you to upgrade.</p>
<p>If invalid JSON data was submitted Flask will now raise a
<a class="reference external" href="https://werkzeug.palletsprojects.com/en/1.0.x/exceptions/#werkzeug.exceptions.BadRequest" title="(in Werkzeug v1.0.x)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">BadRequest</span></code></a> exception instead of letting the
default <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> bubble up.  This has the advantage that you no
longer have to handle that error to avoid an internal server error showing
up for the user.  If you were catching this down explicitly in the past
as <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a> you will need to change this.</p>
<p>Due to a bug in the test client Flask 0.7 did not trigger teardown
handlers when the test client was used in a with statement.  This was
since fixed but might require some changes in your test suites if you
relied on this behavior.</p>
</div>
<div class="section" id="version-0-7">
<h2>Version 0.7<a class="headerlink" href="#version-0-7" title="Permalink to this headline">¶</a></h2>
<p>In Flask 0.7 we cleaned up the code base internally a lot and did some
backwards incompatible changes that make it easier to implement larger
applications with Flask.  Because we want to make upgrading as easy as
possible we tried to counter the problems arising from these changes by
providing a script that can ease the transition.</p>
<p>The script scans your whole application and generates a unified diff with
changes it assumes are safe to apply.  However as this is an automated
tool it won’t be able to find all use cases and it might miss some.  We
internally spread a lot of deprecation warnings all over the place to make
it easy to find pieces of code that it was unable to upgrade.</p>
<p>We strongly recommend that you hand review the generated patchfile and
only apply the chunks that look good.</p>
<p>If you are using git as version control system for your project we
recommend applying the patch with <code class="docutils literal notranslate"><span class="pre">path</span> <span class="pre">-p1</span> <span class="pre">&lt;</span> <span class="pre">patchfile.diff</span></code> and then
using the interactive commit feature to only apply the chunks that look
good.</p>
<p>To apply the upgrade script do the following:</p>
<ol class="arabic">
<li><p>Download the script: <a class="reference external" href="https://raw.githubusercontent.com/pallets/flask/0.12.3/scripts/flask-07-upgrade.py">flask-07-upgrade.py</a></p></li>
<li><p>Run it in the directory of your application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python flask-07-upgrade.py &gt; patchfile.diff
</pre></div>
</div>
</li>
<li><p>Review the generated patchfile.</p></li>
<li><p>Apply the patch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ patch -p1 &lt; patchfile.diff
</pre></div>
</div>
</li>
<li><p>If you were using per-module template folders you need to move some
templates around.  Previously if you had a folder named <code class="file docutils literal notranslate"><span class="pre">templates</span></code>
next to a blueprint named <code class="docutils literal notranslate"><span class="pre">admin</span></code> the implicit template path
automatically was <code class="file docutils literal notranslate"><span class="pre">admin/index.html</span></code> for a template file called
<code class="file docutils literal notranslate"><span class="pre">templates/index.html</span></code>.  This no longer is the case.  Now you need
to name the template <code class="file docutils literal notranslate"><span class="pre">templates/admin/index.html</span></code>.  The tool will
not detect this so you will have to do that on your own.</p></li>
</ol>
<p>Please note that deprecation warnings are disabled by default starting
with Python 2.7.  In order to see the deprecation warnings that might be
emitted you have to enabled them with the <a class="reference external" href="https://docs.python.org/3/library/warnings.html#module-warnings" title="(in Python v3.8)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">warnings</span></code></a> module.</p>
<p>If you are working with windows and you lack the <code class="docutils literal notranslate"><span class="pre">patch</span></code> command line
utility you can get it as part of various Unix runtime environments for
windows including cygwin, msysgit or ming32.  Also source control systems
like svn, hg or git have builtin support for applying unified diffs as
generated by the tool.  Check the manual of your version control system
for more information.</p>
<div class="section" id="bug-in-request-locals">
<h3>Bug in Request Locals<a class="headerlink" href="#bug-in-request-locals" title="Permalink to this headline">¶</a></h3>
<p>Due to a bug in earlier implementations the request local proxies now
raise a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> instead of an <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#AttributeError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AttributeError</span></code></a> when they
are unbound.  If you caught these exceptions with <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#AttributeError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AttributeError</span></code></a>
before, you should catch them with <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">RuntimeError</span></code></a> now.</p>
<p>Additionally the <a class="reference internal" href="../api/#flask.send_file" title="flask.send_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">send_file()</span></code></a> function is now issuing
deprecation warnings if you depend on functionality that will be removed
in Flask 0.11.  Previously it was possible to use etags and mimetypes
when file objects were passed.  This was unreliable and caused issues
for a few setups.  If you get a deprecation warning, make sure to
update your application to work with either filenames there or disable
etag attaching and attach them yourself.</p>
<p>Old code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">my_file_object</span><span class="p">)</span>
<span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">my_file_object</span><span class="p">)</span>
</pre></div>
</div>
<p>New code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">my_file_object</span><span class="p">,</span> <span class="n">add_etags</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="upgrading-to-new-teardown-handling">
<span id="id1"></span><h3>Upgrading to new Teardown Handling<a class="headerlink" href="#upgrading-to-new-teardown-handling" title="Permalink to this headline">¶</a></h3>
<p>We streamlined the behavior of the callbacks for request handling.  For
things that modify the response the <a class="reference internal" href="../api/#flask.Flask.after_request" title="flask.Flask.after_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">after_request()</span></code></a>
decorators continue to work as expected, but for things that absolutely
must happen at the end of request we introduced the new
<a class="reference internal" href="../api/#flask.Flask.teardown_request" title="flask.Flask.teardown_request"><code class="xref py py-meth docutils literal notranslate"><span class="pre">teardown_request()</span></code></a> decorator.  Unfortunately that
change also made after-request work differently under error conditions.
It’s not consistently skipped if exceptions happen whereas previously it
might have been called twice to ensure it is executed at the end of the
request.</p>
<p>If you have database connection code that looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">after_request</span>
<span class="k">def</span> <span class="nf">after_request</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="n">g</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
<p>You are now encouraged to use this instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">teardown_request</span>
<span class="k">def</span> <span class="nf">after_request</span><span class="p">(</span><span class="n">exception</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;db&#39;</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>On the upside this change greatly improves the internal code flow and
makes it easier to customize the dispatching and error handling.  This
makes it now a lot easier to write unit tests as you can prevent closing
down of database connections for a while.  You can take advantage of the
fact that the teardown callbacks are called when the response context is
removed from the stack so a test can query the database after request
handling:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="c1"># g.db is still bound if there is such a thing</span>

<span class="c1"># and here it&#39;s gone</span>
</pre></div>
</div>
</div>
<div class="section" id="manual-error-handler-attaching">
<h3>Manual Error Handler Attaching<a class="headerlink" href="#manual-error-handler-attaching" title="Permalink to this headline">¶</a></h3>
<p>While it is still possible to attach error handlers to
<code class="xref py py-attr docutils literal notranslate"><span class="pre">Flask.error_handlers</span></code> it’s discouraged to do so and in fact
deprecated.  In general we no longer recommend custom error handler
attaching via assignments to the underlying dictionary due to the more
complex internal handling to support arbitrary exception classes and
blueprints.  See <code class="xref py py-meth docutils literal notranslate"><span class="pre">Flask.errorhandler()</span></code> for more information.</p>
<p>The proper upgrade is to change this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">error_handlers</span><span class="p">[</span><span class="mi">403</span><span class="p">]</span> <span class="o">=</span> <span class="n">handle_error</span>
</pre></div>
</div>
<p>Into this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">register_error_handler</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="n">handle_error</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively you should just attach the function with a decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">errorhandler</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">handle_error</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>(Note that <code class="xref py py-meth docutils literal notranslate"><span class="pre">register_error_handler()</span></code> is new in Flask 0.7)</p>
</div>
<div class="section" id="blueprint-support">
<h3>Blueprint Support<a class="headerlink" href="#blueprint-support" title="Permalink to this headline">¶</a></h3>
<p>Blueprints replace the previous concept of “Modules” in Flask.  They
provide better semantics for various features and work better with large
applications.  The update script provided should be able to upgrade your
applications automatically, but there might be some cases where it fails
to upgrade.  What changed?</p>
<ul class="simple">
<li><p>Blueprints need explicit names.  Modules had an automatic name
guessing scheme where the shortname for the module was taken from the
last part of the import module.  The upgrade script tries to guess
that name but it might fail as this information could change at
runtime.</p></li>
<li><p>Blueprints have an inverse behavior for <code class="xref py py-meth docutils literal notranslate"><span class="pre">url_for()</span></code>.  Previously
<code class="docutils literal notranslate"><span class="pre">.foo</span></code> told <code class="xref py py-meth docutils literal notranslate"><span class="pre">url_for()</span></code> that it should look for the endpoint
<code class="docutils literal notranslate"><span class="pre">foo</span></code> on the application.  Now it means “relative to current module”.
The script will inverse all calls to <code class="xref py py-meth docutils literal notranslate"><span class="pre">url_for()</span></code> automatically for
you.  It will do this in a very eager way so you might end up with
some unnecessary leading dots in your code if you’re not using
modules.</p></li>
<li><p>Blueprints do not automatically provide static folders.  They will
also no longer automatically export templates from a folder called
<code class="file docutils literal notranslate"><span class="pre">templates</span></code> next to their location however but it can be enabled from
the constructor.  Same with static files: if you want to continue
serving static files you need to tell the constructor explicitly the
path to the static folder (which can be relative to the blueprint’s
module path).</p></li>
<li><p>Rendering templates was simplified.  Now the blueprints can provide
template folders which are added to a general template searchpath.
This means that you need to add another subfolder with the blueprint’s
name into that folder if you want <code class="file docutils literal notranslate"><span class="pre">blueprintname/template.html</span></code> as
the template name.</p></li>
</ul>
<p>If you continue to use the <code class="docutils literal notranslate"><span class="pre">Module</span></code> object which is deprecated, Flask will
restore the previous behavior as good as possible.  However we strongly
recommend upgrading to the new blueprints as they provide a lot of useful
improvement such as the ability to attach a blueprint multiple times,
blueprint specific error handlers and a lot more.</p>
</div>
</div>
<div class="section" id="version-0-6">
<h2>Version 0.6<a class="headerlink" href="#version-0-6" title="Permalink to this headline">¶</a></h2>
<p>Flask 0.6 comes with a backwards incompatible change which affects the
order of after-request handlers.  Previously they were called in the order
of the registration, now they are called in reverse order.  This change
was made so that Flask behaves more like people expected it to work and
how other systems handle request pre- and post-processing.  If you
depend on the order of execution of post-request functions, be sure to
change the order.</p>
<p>Another change that breaks backwards compatibility is that context
processors will no longer override values passed directly to the template
rendering function.  If for example <code class="docutils literal notranslate"><span class="pre">request</span></code> is as variable passed
directly to the template, the default context processor will not override
it with the current request object.  This makes it easier to extend
context processors later to inject additional variables without breaking
existing template not expecting them.</p>
</div>
<div class="section" id="version-0-5">
<h2>Version 0.5<a class="headerlink" href="#version-0-5" title="Permalink to this headline">¶</a></h2>
<p>Flask 0.5 is the first release that comes as a Python package instead of a
single module.  There were a couple of internal refactoring so if you
depend on undocumented internal details you probably have to adapt the
imports.</p>
<p>The following changes may be relevant to your application:</p>
<ul class="simple">
<li><p>autoescaping no longer happens for all templates.  Instead it is
configured to only happen on files ending with <code class="docutils literal notranslate"><span class="pre">.html</span></code>, <code class="docutils literal notranslate"><span class="pre">.htm</span></code>,
<code class="docutils literal notranslate"><span class="pre">.xml</span></code> and <code class="docutils literal notranslate"><span class="pre">.xhtml</span></code>.  If you have templates with different
extensions you should override the
<a class="reference internal" href="../api/#flask.Flask.select_jinja_autoescape" title="flask.Flask.select_jinja_autoescape"><code class="xref py py-meth docutils literal notranslate"><span class="pre">select_jinja_autoescape()</span></code></a> method.</p></li>
<li><p>Flask no longer supports zipped applications in this release.  This
functionality might come back in future releases if there is demand
for this feature.  Removing support for this makes the Flask internal
code easier to understand and fixes a couple of small issues that make
debugging harder than necessary.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">create_jinja_loader</span></code> function is gone.  If you want to customize
the Jinja loader now, use the
<a class="reference internal" href="../api/#flask.Flask.create_jinja_environment" title="flask.Flask.create_jinja_environment"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_jinja_environment()</span></code></a> method instead.</p></li>
</ul>
</div>
<div class="section" id="version-0-4">
<h2>Version 0.4<a class="headerlink" href="#version-0-4" title="Permalink to this headline">¶</a></h2>
<p>For application developers there are no changes that require changes in
your code.  In case you are developing on a Flask extension however, and
that extension has a unittest-mode you might want to link the activation
of that mode to the new <code class="docutils literal notranslate"><span class="pre">TESTING</span></code> flag.</p>
</div>
<div class="section" id="version-0-3">
<h2>Version 0.3<a class="headerlink" href="#version-0-3" title="Permalink to this headline">¶</a></h2>
<p>Flask 0.3 introduces configuration support and logging as well as
categories for flashing messages.  All these are features that are 100%
backwards compatible but you might want to take advantage of them.</p>
<div class="section" id="configuration-support">
<h3>Configuration Support<a class="headerlink" href="#configuration-support" title="Permalink to this headline">¶</a></h3>
<p>The configuration support makes it easier to write any kind of application
that requires some sort of configuration.  (Which most likely is the case
for any application out there).</p>
<p>If you previously had code like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">DEBUG</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">SECRET_KEY</span>
</pre></div>
</div>
<p>You no longer have to do that, instead you can just load a configuration
into the config object.  How this works is outlined in <a class="reference internal" href="../config/#config"><span class="std std-ref">Configuration Handling</span></a>.</p>
</div>
<div class="section" id="logging-integration">
<h3>Logging Integration<a class="headerlink" href="#logging-integration" title="Permalink to this headline">¶</a></h3>
<p>Flask now configures a logger for you with some basic and useful defaults.
If you run your application in production and want to profit from
automatic error logging, you might be interested in attaching a proper log
handler.  Also you can start logging warnings and errors into the logger
when appropriately.  For more information on that, read
<a class="reference internal" href="../errorhandling/#application-errors"><span class="std std-ref">Application Errors</span></a>.</p>
</div>
<div class="section" id="categories-for-flash-messages">
<h3>Categories for Flash Messages<a class="headerlink" href="#categories-for-flash-messages" title="Permalink to this headline">¶</a></h3>
<p>Flash messages can now have categories attached.  This makes it possible
to render errors, warnings or regular messages differently for example.
This is an opt-in feature because it requires some rethinking in the code.</p>
<p>Read all about that in the <a class="reference internal" href="../patterns/flashing/#message-flashing-pattern"><span class="std std-ref">Message Flashing</span></a> pattern.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
  <span id="sidebar-top"></span>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  
    
            <p class="logo"><a href="../">
              <img class="logo" src="../_static/flask-icon.png" alt="Logo"/>
            </a></p>
  

  <h3>Contents</h3>
  <ul>
<li><a class="reference internal" href="#">Upgrading to Newer Releases</a><ul>
<li><a class="reference internal" href="#version-0-12">Version 0.12</a><ul>
<li><a class="reference internal" href="#changes-to-send-file">Changes to send_file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-0-11">Version 0.11</a><ul>
<li><a class="reference internal" href="#debugging">Debugging</a></li>
<li><a class="reference internal" href="#error-handling">Error handling</a></li>
<li><a class="reference internal" href="#templating">Templating</a></li>
<li><a class="reference internal" href="#extension-imports">Extension imports</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-0-10">Version 0.10</a></li>
<li><a class="reference internal" href="#version-0-9">Version 0.9</a></li>
<li><a class="reference internal" href="#version-0-8">Version 0.8</a></li>
<li><a class="reference internal" href="#version-0-7">Version 0.7</a><ul>
<li><a class="reference internal" href="#bug-in-request-locals">Bug in Request Locals</a></li>
<li><a class="reference internal" href="#upgrading-to-new-teardown-handling">Upgrading to new Teardown Handling</a></li>
<li><a class="reference internal" href="#manual-error-handler-attaching">Manual Error Handler Attaching</a></li>
<li><a class="reference internal" href="#blueprint-support">Blueprint Support</a></li>
</ul>
</li>
<li><a class="reference internal" href="#version-0-6">Version 0.6</a></li>
<li><a class="reference internal" href="#version-0-5">Version 0.5</a></li>
<li><a class="reference internal" href="#version-0-4">Version 0.4</a></li>
<li><a class="reference internal" href="#version-0-3">Version 0.3</a><ul>
<li><a class="reference internal" href="#configuration-support">Configuration Support</a></li>
<li><a class="reference internal" href="#logging-integration">Logging Integration</a></li>
<li><a class="reference internal" href="#categories-for-flash-messages">Categories for Flash Messages</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Navigation</h3>
<ul>
  <li><a href="../">Overview</a>
    <ul>
          <li>Previous: <a href="../styleguide/" title="previous chapter">Pocoo Styleguide</a>
          <li>Next: <a href="../changelog/" title="next chapter">Changelog</a>
    </ul>
  </li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="footer" role="contentinfo">
        &#169; Copyright 2010 Pallets.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.2.
    </div>
    <script>
      if (typeof READTHEDOCS_DATA !== 'undefined') {
        if (!READTHEDOCS_DATA.features) {
          READTHEDOCS_DATA.features = {};
        }
        READTHEDOCS_DATA.features.docsearch_disabled = true;
      }
    </script>
  <script type="text/javascript" src="../_static/version_warning_offset.js"></script>

  </body>
</html>